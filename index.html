<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Call Mithra Chatbot</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .chat-container {
      background: white;
      width: 100%;
      max-width: 480px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      padding: 20px;
    }
    .header {
      text-align: center;
      color: maroon;
      font-size: 1.8rem;
      font-weight: bold;
    }
    .slogan {
      text-align: center;
      font-size: 0.95rem;
      color: black;
      margin-bottom: 15px;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1.5px solid #ccc;
      font-size: 1rem;
    }
    #chatbox {
      margin-top: 20px;
      background: #fafafa;
      border-radius: 8px;
      padding: 15px;
      min-height: 280px;
      border: 1px solid #ddd;
      overflow-y: auto;
    }
    .contact-box {
      background-color: #fff5f5;
      border: 1px solid maroon;
      border-radius: 10px;
      padding: 10px 14px;
      margin-bottom: 12px;
      color: maroon;
      font-size: 1rem;
      line-height: 1.5;
    }
    .bot-message {
      color: maroon;
      margin-bottom: 12px;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    .typing {
      font-style: italic;
      color: gray;
      margin-top: 10px;
    }
    .button-bar {
      margin-top: 15px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      background: #ffcccb;
      color: maroon;
      cursor: pointer;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 99;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      position: relative;
    }
    .close {
      position: absolute;
      right: 10px; top: 5px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="chat-container">
  <div class="header">Call Mithra</div>
  <div class="slogan">Together For A Better Tomorrow</div>

  <label for="placeSelect">Select Place:</label>
  <select id="placeSelect">
    <option value="">-- Select Place --</option>
    <option>Alampallam</option>
    <option>Kollengode</option>
    <option>Mathur</option>
  </select>

  <label for="categorySelect">Select Category:</label>
  <select id="categorySelect">
    <option value="">-- Select Category --</option>
    <option>Caterers</option>
    <option>Vaideekhal</option>
    <option>Temple Priests</option>
    <option>Business</option>
    <option>Advocates</option>
    <option>Other Services</option>
  </select>

  <label for="faqSelect">Select FAQ:</label>
  <select id="faqSelect">
    <option value="">-- Select FAQ --</option>
    <option>Who is Mithra?</option>
    <option>Can we use Call Mithra App free?</option>
    <option>Are the phone numbers updated often?</option>
    <option>Contact Mithra</option>
  </select>

  <div id="chatbox"></div>

  <div class="button-bar">
    <button onclick="showModal('eventsModal')">Events</button>
    <button onclick="showModal('panchangModal')">Panchang</button>
  </div>
</div>

<!-- Events Modal -->
<div id="eventsModal" class="modal" onclick="closeOutside(event, 'eventsModal')">
  <div class="modal-content">
    <span class="close" onclick="hideModal('eventsModal')">&times;</span>
    <div id="eventsContent">Loading events...</div>
  </div>
</div>

<!-- Panchang Modal -->
<div id="panchangModal" class="modal" onclick="closeOutside(event, 'panchangModal')">
  <div class="modal-content">
    <span class="close" onclick="hideModal('panchangModal')">&times;</span>
    <div id="panchangContent">Loading panchang...</div>
  </div>
</div>

<script>
const contactsUrl = "https://script.google.com/macros/s/AKfycbzp9FtlQdfPcpGzYqCyVopORCRGindGyAnumibl2uZojyYPHQ7hTn1W_NyTxNp_unsypQ/exec";
const faqUrl = "https://script.google.com/macros/s/AKfycbxqvwmPTZT7RBm3PwxhuAYUYgu-7RnGhmWO7zrO3qUVXYg1nXl3Wewv9HE3n8fHQKxU/exec";
const eventsUrl = "https://script.google.com/macros/s/AKfycbyREuWL3hPqmJj9T_g-LjDwB34D9DSaPD2KzjFx8Zd_aSUPMEu_ysqKqraeT6USx3Pmww/exec";
const panchangUrl = "https://script.google.com/macros/s/AKfycbzUdmenvxUvm64nc6HMiPimJIJCyYpPpiyLzl--veCZ7YGAaNjJzHtBpWV9Q4FKXu7r/exec";
const usageLogUrl = "https://script.google.com/macros/s/AKfycbwBJI8rqGMfLHXQMwwIF8BcKvR-uH9FHdcnTO5fN6TlCxIMQY7gR_R_iF-l8tLdLwc-jg/exec";

const chatbox = document.getElementById('chatbox');
const placeSelect = document.getElementById('placeSelect');
const categorySelect = document.getElementById('categorySelect');
const faqSelect = document.getElementById('faqSelect');

function showTyping() {
  chatbox.innerHTML = '<div class="typing">Mithra is typing...</div>';
}
function clearChat() {
  chatbox.innerHTML = '';
}
function appendCard(content) {
  const div = document.createElement('div');
  div.className = 'contact-box';
  div.innerHTML = content;
  chatbox.appendChild(div);
}
function appendError(message) {
  const div = document.createElement('div');
  div.className = 'error';
  div.textContent = message;
  chatbox.appendChild(div);
}

async function fetchContacts() {
  const place = placeSelect.value;
  const category = categorySelect.value;
  if (!place || !category) return;

  clearChat();
  showTyping();

  try {
    const response = await fetch(`${contactsUrl}?place=${encodeURIComponent(place)}&category=${encodeURIComponent(category)}`);
    const data = await response.json();
    clearChat();

    if (data.reply && data.reply.length) {
      data.reply.forEach(contact => {
        const content = `${place} ${category}<br>${contact.name}<br>${contact.phone1}<br>${contact.phone2}`;
        appendCard(content);
      });
    } else {
      appendError("No contacts found.");
    }
  } catch {
    clearChat();
    appendError("Server error. Try again.");
  }
}

async function fetchFaq() {
  const faq = faqSelect.value;
  if (!faq) return;

  clearChat();
  showTyping();
  try {
    const response = await fetch(`${faqUrl}?faq=${encodeURIComponent(faq)}`);
    const data = await response.json();
    clearChat();
    appendCard(data.reply);
  } catch {
    clearChat();
    appendError("Could not fetch FAQ.");
  }
}

async function fetchEvents() {
  const res = await fetch(eventsUrl);
  const data = await res.json();
  document.getElementById('eventsContent').innerText = data.reply || "No events found.";
}
async function fetchPanchang() {
  const res = await fetch(panchangUrl);
  const data = await res.json();
  document.getElementById('panchangContent').innerText = data.reply || "No data found.";
}

function showModal(id) {
  document.getElementById(id).style.display = 'block';
  if (id === 'eventsModal') fetchEvents();
  if (id === 'panchangModal') fetchPanchang();
}
function hideModal(id) {
  document.getElementById(id).style.display = 'none';
}
function closeOutside(e, id) {
  if (e.target.id === id) hideModal(id);
}

placeSelect.addEventListener('change', () => {
  faqSelect.value = '';
  fetchContacts();
});
categorySelect.addEventListener('change', () => {
  faqSelect.value = '';
  fetchContacts();
});
faqSelect.addEventListener('change', () => {
  placeSelect.value = '';
  categorySelect.value = '';
  fetchFaq();
});
</script>

</body>
</html>
