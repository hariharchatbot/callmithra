<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Call Mithra</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f8f8f8;
      margin: 0; padding: 0;
    }
    .chat-container {
      max-width: 480px;
      margin: auto;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .header {
      color: maroon;
      font-size: 1.8rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 4px;
    }
    .slogan {
      color: black;
      font-size: 1rem;
      text-align: center;
      margin-bottom: 20px;
    }
    select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    #chatbox {
      margin-top: 20px;
    }
    .contact-box {
      border: 1px solid maroon;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 12px;
      background: #fff5f5;
      font-size: 1.1rem;
      line-height: 1.5;
    }
    .error {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }
    .loader {
      text-align: center;
      font-style: italic;
      color: gray;
    }
  </style>
</head>
<body>

<div class="chat-container">
  <div class="header">Call Mithra</div>
  <div class="slogan">Together For A Better Tomorrow</div>

  <select id="placeSelect">
    <option value="">-- Select Place --</option>
    <option>Alampallam</option>
    <option>Kollengode</option>
    <option>Mathur</option>
  </select>

  <select id="categorySelect">
    <option value="">-- Select Category --</option>
    <option>Caterers</option>
    <option>Vaideekhal</option>
    <option>Temple Priests</option>
    <option>Business</option>
    <option>Advocates</option>
    <option>Other Services</option>
  </select>

  <select id="faqSelect">
    <option value="">-- Select FAQ --</option>
    <option>Who is Mithra?</option>
    <option>Can we use Call Mithra App free?</option>
    <option>Are the phone numbers updated often?</option>
    <option>Contact Mithra</option>
  </select>

  <button onclick="showModal('events')">Events</button>
  <button onclick="showModal('panchang')">Panchang</button>

  <div id="chatbox"></div>
</div>

<!-- Modal -->
<div id="modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);">
  <div style="background:white;max-width:400px;margin:80px auto;padding:20px;border-radius:10px;position:relative;">
    <span onclick="closeModal()" style="position:absolute;top:8px;right:12px;cursor:pointer;font-weight:bold;">✖</span>
    <div id="modalContent">Loading...</div>
  </div>
</div>

<script>
  const placeSelect = document.getElementById('placeSelect');
  const categorySelect = document.getElementById('categorySelect');
  const faqSelect = document.getElementById('faqSelect');
  const chatbox = document.getElementById('chatbox');

  const contactsUrl = 'https://script.google.com/macros/s/AKfycbzljP53EAr9tD7we62zp8qjigDcCFSb15YN9iTIYRqtTZTPYueDMGicPAf6uJJTPdAr5Q/exec'; // ← Replace with your final contact URL
  const faqUrl = 'https://script.google.com/macros/s/AKfycbxqvwmPTZT7RBm3PwxhuAYUYgu-7RnGhmWO7zrO3qUVXYg1nXl3Wewv9HE3n8fHQKxU/exec';
  const eventsUrl = 'https://script.google.com/macros/s/AKfycbyREuWL3hPqmJj9T_g-LjDwB34D9DSaPD2KzjFx8Zd_aSUPMEu_ysqKqraeT6USx3Pmww/exec';
  const panchangUrl = 'https://script.google.com/macros/s/AKfycbzSyfRSGvyukUqkAKWsTdSediLOF6LQ1H7MhLlwwkXc2MYxZfEKRreN5_oLj8dIvas/exec';
  const usageLogUrl = 'https://script.google.com/macros/s/AKfycbwBJI8rqGMfLHXQMwwIF8BcKvR-uH9FHdcnTO5fN6TlCxIMQY7gR_R_iF-l8tLdLwc-jg/exec';

  function clearChat() {
    chatbox.innerHTML = '';
  }

  function appendContactCard(contact) {
    const div = document.createElement('div');
    div.className = 'contact-box';
    div.innerHTML = `
      ${contact.title}<br>
      ${contact.name}<br>
      ${contact.phone1}<br>
      ${contact.phone2}
    `;
    chatbox.appendChild(div);
  }

  function appendError(message) {
    const div = document.createElement('div');
    div.className = 'error';
    div.textContent = message;
    chatbox.appendChild(div);
  }

  function showLoader() {
    const div = document.createElement('div');
    div.className = 'loader';
    div.textContent = 'Mithra is fetching data...';
    chatbox.appendChild(div);
  }

  function removeLoader() {
    const loader = document.querySelector('.loader');
    if (loader) loader.remove();
  }

  async function fetchContacts() {
    const place = placeSelect.value;
    const category = categorySelect.value;

    if (!place || !category) return;

    clearChat();
    showLoader();

    try {
      const res = await fetch(`${contactsUrl}?place=${encodeURIComponent(place)}&category=${encodeURIComponent(category)}`);
      const data = await res.json();
      removeLoader();

      if (data.contacts) {
        data.contacts.forEach(appendContactCard);
      } else {
        appendError(data.reply || "No data found.");
      }
    } catch {
      removeLoader();
      appendError("Server error. Please try again.");
    }
  }

  async function fetchFAQ() {
    const faq = faqSelect.value;
    if (!faq) return;

    clearChat();
    showLoader();

    try {
      const res = await fetch(`${faqUrl}?faq=${encodeURIComponent(faq)}`);
      const data = await res.json();
      removeLoader();
      appendContactCard({ title: "FAQ", name: data.reply, phone1: "", phone2: "" });
    } catch {
      removeLoader();
      appendError("Server error. Please try again.");
    }
  }

  async function fetchModalData(url) {
    const modal = document.getElementById('modal');
    const content = document.getElementById('modalContent');
    modal.style.display = 'block';
    content.innerHTML = "Loading...";

    try {
      const res = await fetch(url);
      const data = await res.json();
      content.innerHTML = `<pre>${data.reply || "No data found."}</pre>`;
    } catch {
      content.innerHTML = `<span class="error">Error loading data.</span>`;
    }
  }

  function showModal(type) {
    if (type === 'events') fetchModalData(eventsUrl);
    if (type === 'panchang') fetchModalData(panchangUrl);
  }

  function closeModal() {
    document.getElementById('modal').style.display = 'none';
  }

  window.onclick = function(e) {
    if (e.target === document.getElementById('modal')) {
      closeModal();
    }
  };

  // Event listeners
  placeSelect.addEventListener('change', () => {
    faqSelect.value = "";
    fetchContacts();
  });

  categorySelect.addEventListener('change', () => {
    faqSelect.value = "";
    fetchContacts();
  });

  faqSelect.addEventListener('change', () => {
    placeSelect.value = "";
    categorySelect.value = "";
    fetchFAQ();
  });
</script>

</body>
</html>
